# Cycle-GAN / UDCT
Modified version of the UDCT cycle-GAN. Different data processing and complete validation added.
Version uses Tensorflow(-GPU) 1.4 and Python 2.7. Python 2.7 was chosen for the original implementation.
Therefore, to avoid bugs, we chose the same version. 
A future upgrade to python 3 is desired. Other requirements are provided in the file requirements.txt.

## Installation
1.  Clone or download the repository:
    <pre> git clone https://github.com/Demisio/UDCT.git </pre>
2.  Create an environment for the packages to be installed. With conda, e.g (less tested with python 3.6 & TF 1.5 but seems to work): 
    <pre >conda create -n UDCT python=2.7 
    conda create -n UDCT python=3.6</pre>

2.  Install requirements via: 
    <pre> pip install -r requirements.txt </pre>
4.  Required CUDA / CUDNN versions:
    <pre>Python 2.7, TF 1.4: CUDA 8.0 / CUDNN 6.0
    Python 3.6, TF 1.5: CUDA 9.0 / CUDNN 7.0</pre>
    
## Creating a Dataset, Data Splits and Log Folders
1.  Images are given in ./Data/Heart/3D. Creating a hdf5 dataset is achieved by navigating into the folder dataprocessing
    and executing the file aug_heart_data_noisy.h5
    <pre>cd data_processing
    python aug_heart_data_noisy.h5</pre>
2.  Datasplits are already provided but can be generated by navigating into the folder ./train_test_split and executing
    the file create_splits.py
    <pre>cd train_test_split
    python create_splits.py</pre>
3.  2 Dictionaries, called "logs" and "Models" have to be created in the main Project folder. These dictionaries should
    contain subfolders with the name of the experiment and 5 subsubfolders called fold_1 until fold_5, e.g.:
    <pre>./Models/Heart/fold_1
    ./logs/Heart/fold_4</pre>
   
## Training the network
1.  For training the network, the script main.py should be exectued.
    The Model and log directories, as well as the fold have to be provided, e.g.:
    <pre>python main.py --dataset=./data_processing/aug_heart_data_noisy.h5 --name=Heart --log_name=Heart_ --fold=1</pre>
### Parameters

All parameters are of the shape: --&lt;parameter_name&gt;=&lt;value&gt; <br />
Below is the list of all possible parameters that can be set. The standard value used if the parameter is not defined is given in brackets

<b>name ('unnamed')</b><br />
Name of the model. This value should be unique to not load/overwrite old models. Its value must be changed to ensure functionality!
<br />

<b>dataset ('pathtodata.h5')</b><br />
Describes which h5 files is used. Its value must be changed to ensure functionality!
<br />

<b>architecture ('Res6')</b><br />
The network architecture for the generators. Currently, you can choose between 'Res6' and 'Res9', which corresponds to 6 and 9 residual layers, respectively.
<br />

<b>deconv ('transpose')</b><br />
Upsampling method used in the generators. You can either choose transpose CNNs ('transpose') or image resizing ('resize').
<br />

<b>PatchGAN ('Patch70')</b><br />
Different PatchGAN Architectures: 'Patch34', 'Patch70', or 'Patch142'. A mixture of these is possible: 'MultiPatch' (experimental).
<br />

<b>mode ('training')</b><br />
Decides what should be done with the network. You can either train it ('training'), or create generated images: 'gen_A' for raw images from synthetic images and 'gen_B' for synthetic images from raw images.
<br />



<b>dataset ('pathtodata.h5')</b><br />
Describes which h5 files is used. Its value must be changed to ensure functionality!
<br />

<b>lambda_c (10.)</b><br />
The loss multiplier of the cycle consistency term used while training the generators.
<br />

<b>lambda_h (1.)</b><br />
The loss multiplier of the histogram discriminators. If the histogram should not be used, set this term to 0.
<br />

<b>dis_noise (0.1)</b><br />
To make the network more stable, we added noise to the input of the discriminators, which slowly decays over time. This value describes how high the std of the gaussian noise is, which is added to the inputs.
<br />

<b>syn_noise (0.)</b><br />
It is possible to add gaussian noise to the synthetic dataset. Default: not used.
<br />

<b>real_noise (0.)</b><br />
It is possible to add gaussian noise to the real dataset. Default: not used.
<br />

<b>epoch (200)</b><br />
Number of training epochs.
<br />

<b>batch_size (4)</b><br />
Batch size during training.
<br />

<b>buffer_size (50)</b><br />
Size of the buffer (history) saved to train the discriminators. This makes the network more stable.
<br />

<b>save (1)</b><br />
If value is not 0, the network progress is saved at the end of each epoch.
<br />

<b>gpu (0)</b><br />
If multiple GPUs exist, this parameter choses which GPU should be used. Only one GPU can currently be used.
<br />

<b>verbose (0)</b><br />
If value is not 0, the network is more verbose.
<br />
